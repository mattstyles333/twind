{{- define "main" -}}
{{- $data := .Site.Data.glasses -}}

<div class="min-h-screen bg-gray-100 p-8">
  <div class="max-w-7xl mx-auto">


    <!-- Test Controls -->
    <div class="bg-white rounded-lg shadow-md p-6 mb-8">
      <h2 class="text-xl font-semibold mb-4">Test Controls</h2>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Viewport Size</label>
          <select id="viewport-size" class="w-full border border-gray-300 rounded-md px-3 py-2">
            <option value="desktop">Desktop</option>
            <option value="tablet">Tablet</option>
            <option value="mobile">Mobile</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Background</label>
          <select id="background" class="w-full border border-gray-300 rounded-md px-3 py-2">
            <option value="light">Light</option>
            <option value="dark">Dark</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Show Info</label>
          <input type="checkbox" id="show-info" class="mr-2">
          <label for="show-info" class="text-sm text-gray-700">Display component info</label>
        </div>
      </div>
    </div>

    <!-- Component Info -->
    <div id="component-info" class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-8 hidden">
      <h3 class="text-lg font-semibold text-blue-900 mb-2">Component Information</h3>
      <div class="text-sm text-blue-800">
        <p><strong>File:</strong> hugo/layouts/partials/glasses-megamenu.html</p>
        <p><strong>Data Source:</strong> hugo/data/glasses.yaml (megamenu section)</p>
        <p><strong>Usage:</strong> {{ partial "glasses-megamenu.html" $data.megamenu }}</p>
        <p><strong>Last Updated:</strong> {{ now.Format "2006-01-02 15:04:05" }}</p>
      </div>
    </div>

        <!-- Megamenu Component -->
    <div class="bg-white rounded-lg shadow-lg overflow-hidden">
      <div class="border-b border-gray-200 p-4">
        <h2 class="text-xl font-semibold text-gray-900">Component Canvas</h2>
      </div>

      <!-- Component Container -->
      <div id="megamenu-container" class="relative min-h-[500px] p-8">
        {{ partial "glasses-megamenu.html" $data.megamenu }}
      </div>
    </div>

        <!-- Image Card Item Test Section -->
    <div class="mt-8 bg-white rounded-lg shadow-lg overflow-hidden">
              <div class="p-8">
          <h3 class="text-lg font-semibold mb-4">Component Test</h3>
                              <div class="flex items-center gap-6">
            <!-- Links on Left - Scaled for smaller container -->
            <div class="w-1/3">
                                          <div class="grid grid-cols-3 gap-x-6 pl-4 pt-4">
                <!-- Section 1: Glasses -->
                <div class="group space-y-3">
                  <div class="text-lg font-semibold text-slate-800">{{ $data.megamenu.sections.glasses.title }}</div>
                  {{ range $data.megamenu.sections.glasses.links }}
                  <a
                    href="{{ .url }}"
                    class="block text-base font-medium text-gray-700 duration-500 ease-in-out hover:underline group-hover:text-black"
                  >
                    {{ .text }}
                  </a>
                  {{ end }}
                </div>

                <!-- Section 2: Specialty -->
                <div class="group space-y-3">
                  <div class="text-lg font-semibold text-slate-800">{{ $data.megamenu.sections.specialty.title }}</div>
                  {{ range $data.megamenu.sections.specialty.links }}
                  <a
                    href="{{ .url }}"
                    class="block text-base font-medium text-gray-700 duration-500 ease-in-out hover:underline group-hover:text-black"
                  >
                    {{ .text }}
                  </a>
                  {{ end }}
                </div>

                <!-- Section 3: Styles -->
                <div class="group space-y-3">
                  <div class="text-lg font-semibold text-slate-800">{{ $data.megamenu.sections.styles.title }}</div>
                  {{ range $data.megamenu.sections.styles.links }}
                  <a
                    href="{{ .url }}"
                    class="block text-base font-medium text-gray-700 duration-500 ease-in-out hover:underline group-hover:text-black"
                  >
                    {{ .text }}
                  </a>
                  {{ end }}
                </div>
              </div>

              <!-- Promotional Links - below the columns -->
              <div class="col-span-3 flex gap-8 pt-6">
                <a class="flex items-start gap-3" href="/product-quiz-glasses">
                  <div class="flex-shrink-0">
                    <svg width="25" height="25" viewBox="0 0 304 303" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M101.689 1.55188C57.051 9.95588 20.63 41.1339 6.79405 82.7869C-28.279 188.367 79.0041 281.842 178.08 232.027C182.485 229.812 186.83 228 187.735 228C188.64 228 204.884 243.469 223.832 262.375C251.665 290.145 259.375 297.29 263.959 299.564C288.527 311.75 311.879 288.385 299.692 263.812C297.41 259.211 290.303 251.542 262.502 223.678C243.6 204.732 228.134 188.494 228.134 187.593C228.134 186.692 229.946 182.351 232.161 177.946C268.286 106.097 230.524 23.6839 152.134 3.29688C139.842 0.0998828 114.127 -0.789117 101.689 1.55188ZM142.134 34.6569C211.126 48.8639 236.929 135.541 187.271 186.281C145.144 229.327 70.132 218.457 43.277 165.416C8.19205 96.1199 66.443 19.0709 142.134 34.6569ZM103.634 50.0619C83.201 54.0499 74.7 61.9619 79.647 72.3869C83.299 80.0829 88.59 81.3079 101.731 77.4999C127.203 70.1179 153.304 81.2469 166.14 104.961C171.52 114.9 177.012 117.749 184.644 114.56C207.084 105.184 174.515 61.5249 137.634 51.5429C130.377 49.5789 110.537 48.7149 103.634 50.0619Z" fill="#1e3a8a"/></svg>
                  </div>
                  <div class="font-semibold text-slate-800 duration-500 ease-in-out hover:underline">
                    Check Out our Style Finder quiz!
                  </div>
                </a>
                <a class="flex items-start gap-3" href="/trial-home">
                  <div class="flex-shrink-0">
                    <svg width="25" height="25" viewBox="0 0 512 478" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M246.25 1.10204C236.771 2.20504 225.195 6.12604 216.491 11.182C205.521 17.554 7.32069 215.646 2.81669 224.74C-8.95831 248.513 18.5237 275.717 41.9907 263.518C43.9157 262.518 90.8567 216.654 146.305 161.599C201.752 106.545 248.327 60.958 249.805 60.295C253.173 58.784 258.015 58.684 261.676 60.051C263.257 60.641 308.315 104.858 364.491 160.948C435.908 232.255 465.777 261.443 468.991 263.063C487.98 272.635 510.38 259.702 511.773 238.361C512.631 225.228 512.683 225.296 466.443 178.984L425.991 138.468V91.271C425.991 45.56 425.924 43.896 423.86 38.381C414.421 13.151 378.481 13.365 368.999 38.708C367.266 43.339 366.991 46.5 366.991 61.753V79.431L334.741 47.357C299.859 12.665 296.039 9.63004 280.901 4.58704C274.568 2.47704 258.088 -0.298958 254.491 0.138042C253.941 0.205042 250.233 0.639041 246.25 1.10204ZM249.491 116.55C246.162 118.257 78.4967 285.205 73.8907 291.4L70.9907 295.3V363.969C70.9907 424.223 71.1887 433.303 72.6027 438.068C77.9847 456.195 91.7237 470.161 109.608 475.683C114.936 477.329 119.881 477.5 161.991 477.5H208.491L208.748 412.25L209.005 347H255.991H302.977L303.234 412.25L303.491 477.5H349.991C407.176 477.5 410.372 476.817 425.72 461.316C440.945 445.94 440.991 445.648 440.991 363.44V295.3L438.094 291.4C432.938 284.46 264.599 117.14 261.676 116.05C257.693 114.565 252.988 114.758 249.491 116.55Z" fill="#1e3a8a"/></svg>
                  </div>
                  <div class="font-semibold text-slate-800 duration-500 ease-in-out hover:underline">
                    Try our Home Trial Service!
                  </div>
                </a>
              </div>
            </div>

            <!-- Image Card -->
            {{ partial "megamenu/image-card-item.html" (index $data.megamenu.featured_products 0) }}
          </div>
        </div>
    </div>

    <!-- Debug Info -->
    <div class="mt-8 bg-gray-50 rounded-lg p-4">
      <h3 class="text-lg font-semibold text-gray-900 mb-2">Debug Information</h3>
      <div class="text-sm text-gray-700">
        <p><strong>Data Available:</strong> {{ if $data.megamenu }}✅ Yes{{ else }}❌ No{{ end }}</p>
        <p><strong>Sections:</strong> {{ if $data.megamenu.sections }}✅ {{ len $data.megamenu.sections }}{{ else }}❌ None{{ end }}</p>
        <p><strong>Promotional Links:</strong> {{ if $data.megamenu.promotional_links }}✅ {{ len $data.megamenu.promotional_links }}{{ else }}❌ None{{ end }}</p>
        <p><strong>Featured Products:</strong> {{ if $data.megamenu.featured_products }}✅ {{ len $data.megamenu.featured_products }}{{ else }}❌ None{{ end }}</p>
      </div>
    </div>

    <!-- Performance Monitoring -->
    <div class="mt-8 bg-green-50 rounded-lg p-4">
      <h3 class="text-lg font-semibold text-green-900 mb-2">Performance Metrics</h3>
      <div class="text-sm text-green-800">
        <p><strong>DOM Nodes:</strong> <span id="node-count">-</span></p>
        <p><strong>Render Time:</strong> <span id="render-time">-</span>ms</p>
        <p><strong>Image Load Time:</strong> <span id="image-load-time">-</span>ms</p>
        <p><strong>Memory Usage:</strong> <span id="memory-usage">-</span>KB</p>
        <p><strong>Layout Shifts:</strong> <span id="layout-shifts">-</span></p>
      </div>
      <button id="run-performance-test" class="mt-2 px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700">
        Run Performance Test
      </button>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const viewportSelect = document.getElementById('viewport-size');
  const backgroundSelect = document.getElementById('background');
  const showInfoCheckbox = document.getElementById('show-info');
  const componentInfo = document.getElementById('component-info');
  const megamenuContainer = document.getElementById('megamenu-container');

  // Viewport size control
  viewportSelect.addEventListener('change', function() {
    const container = megamenuContainer.querySelector('.container');
    if (container) {
      container.className = 'container mx-auto flex max-w-7xl flex-col gap-4 px-2 sm:flex-row';

      switch(this.value) {
        case 'mobile':
          container.classList.add('max-w-sm');
          break;
        case 'tablet':
          container.classList.add('max-w-2xl');
          break;
        case 'desktop':
          container.classList.remove('max-w-sm', 'max-w-2xl');
          break;
      }
    }
  });

  // Background control
  backgroundSelect.addEventListener('change', function() {
    const container = megamenuContainer.querySelector('.h-80');
    if (container) {
      if (this.value === 'dark') {
        container.classList.remove('bg-white');
        container.classList.add('bg-gray-900');
      } else {
        container.classList.remove('bg-gray-900');
        container.classList.add('bg-white');
      }
    }
  });

  // Show info control
  showInfoCheckbox.addEventListener('change', function() {
    componentInfo.classList.toggle('hidden', !this.checked);
  });

  // Performance monitoring
  const runPerformanceTest = document.getElementById('run-performance-test');
  const nodeCount = document.getElementById('node-count');
  const renderTime = document.getElementById('render-time');
  const imageLoadTime = document.getElementById('image-load-time');
  const memoryUsage = document.getElementById('memory-usage');
  const layoutShifts = document.getElementById('layout-shifts');

  // Count DOM nodes
  function updateNodeCount() {
    const container = megamenuContainer.querySelector('.h-80');
    if (container) {
      const nodes = container.querySelectorAll('*').length;
      nodeCount.textContent = nodes;
    }
  }

  // Measure image load times
  function measureImageLoadTime() {
    const images = megamenuContainer.querySelectorAll('img');
    let totalLoadTime = 0;
    let loadedImages = 0;

    images.forEach(img => {
      if (img.complete) {
        totalLoadTime += 0;
        loadedImages++;
      } else {
        const start = performance.now();
        img.onload = () => {
          const loadTime = performance.now() - start;
          totalLoadTime += loadTime;
          loadedImages++;
          if (loadedImages === images.length) {
            imageLoadTime.textContent = Math.round(totalLoadTime / images.length);
          }
        };
      }
    });

    if (loadedImages === images.length) {
      imageLoadTime.textContent = Math.round(totalLoadTime / images.length);
    }
  }

  // Measure memory usage
  function updateMemoryUsage() {
    if (performance.memory) {
      const used = performance.memory.usedJSHeapSize / 1024;
      memoryUsage.textContent = Math.round(used);
    }
  }

  // Layout shift monitoring
  let layoutShiftCount = 0;
  const observer = new PerformanceObserver((list) => {
    for (const entry of list.getEntries()) {
      if (entry.entryType === 'layout-shift') {
        layoutShiftCount++;
        layoutShifts.textContent = layoutShiftCount;
      }
    }
  });

  if ('PerformanceObserver' in window) {
    observer.observe({ entryTypes: ['layout-shift'] });
  }

  // Run performance test
  runPerformanceTest.addEventListener('click', function() {
    const startTime = performance.now();

    // Simulate component re-render
    const container = megamenuContainer.querySelector('.h-80');
    if (container) {
      container.style.display = 'none';
      container.offsetHeight; // Force reflow
      container.style.display = '';
    }

    const endTime = performance.now();
    renderTime.textContent = Math.round(endTime - startTime);

    updateNodeCount();
    measureImageLoadTime();
    updateMemoryUsage();
  });

  // Initial measurements
  updateNodeCount();
  measureImageLoadTime();
  updateMemoryUsage();
});
</script>
{{- end -}}
