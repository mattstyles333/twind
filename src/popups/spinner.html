<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Spinner</title>
    <script
      src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"
      defer
    ></script>
    <link href="../output.css" rel="stylesheet" />

    <style>
      .wheel {
        transition: transform 4s cubic-bezier(0.33, 1, 0.68, 1);
      }
      .segment {
        position: absolute;
        width: 100%;
        height: 100%;
        clip-path: polygon(50% 50%, 100% 0%, 100% 100%);
        transform-origin: 50% 50%;
        text-align: center;
      }
      .segment:nth-child(odd) {
        background: #3b82f6; /* Blue */
      }
      .segment:nth-child(even) {
        background: #60a5fa; /* Light Blue */
      }
      .inner-circle {
        position: absolute;
        width: 40%;
        height: 40%;
        background: white;
        border-radius: 50%;
        top: 30%;
        left: 30%;
      }
    </style>
  </head>
  <body class="flex min-h-screen items-center justify-center bg-gray-100">
    <div
      x-data="spinner()"
      class="mx-auto w-full max-w-md rounded-lg bg-white p-6 shadow-lg"
    >
      <div class="text-center">
        <h2 class="mb-4 text-2xl font-bold">Win A Mystery Box Worth Â£100</h2>
        <p class="mb-4">
          Sign up and play. Simply spin the wheel for a chance to win an amazing
          deal!
        </p>
        <div class="relative inline-block">
          <div
            class="flex h-64 w-64 items-center justify-center rounded-full border-4 border-gray-200"
          >
            <div
              :style="{transform: 'rotate(' + rotation + 'deg)'}"
              class="wheel relative h-full w-full"
            >
              <template x-for="(segment, index) in segments" :key="index">
                <div
                  :style="getSegmentStyle(index)"
                  class="segment flex items-center justify-center font-bold text-white"
                >
                  <div
                    class="w-full rotate-90 transform text-center"
                    x-text="segment.label"
                  ></div>
                </div>
              </template>
              <div class="inner-circle"></div>
            </div>
          </div>
          <div class="absolute inset-0 flex items-center justify-center">
            <div
              class="h-8 w-2 -translate-y-10 transform rounded-b-full bg-white"
            ></div>
          </div>
        </div>
        <div class="mt-4">
          <input
            type="email"
            x-model="email"
            class="w-full rounded-lg border px-4 py-2"
            placeholder="Email"
          />
          <button
            @click="spin"
            class="mt-2 w-full rounded-lg bg-blue-500 px-4 py-2 text-white"
          >
            Spin Me
          </button>
        </div>
        <p x-show="prize" class="mt-4 text-lg font-bold">
          You won: <span x-text="prize"></span>
        </p>
      </div>
    </div>

    <script>
      function spinner() {
        return {
          email: "",
          prize: "",
          spinning: false,
          rotation: 0,
          segments: [
            { label: "Triple Stacked", probability: 0.1 },
            { label: "Damage Protection", probability: 0.1 },
            { label: "Free Shipping", probability: 0.2 },
            { label: "Mystery Box", probability: 0.05 },
            { label: "Free Anti Reflective", probability: 0.2 },
            { label: "Free Reglaze", probability: 0.35 },
          ],
          spin() {
            if (!this.email) {
              alert("Please enter your email");
              return;
            }
            if (this.spinning) return;
            this.spinning = true;

            const random = Math.random();
            let cumulativeProbability = 0;
            for (const segment of this.segments) {
              cumulativeProbability += segment.probability;
              if (random < cumulativeProbability) {
                this.prize = segment.label;
                break;
              }
            }

            const segmentIndex = this.segments.findIndex(
              (segment) => segment.label === this.prize,
            );
            const segmentAngle = 360 / this.segments.length;
            const stopAngle = segmentIndex * segmentAngle + segmentAngle / 2;
            const rotations = 5 * 360; // number of full rotations
            const randomOffset = Math.random() * segmentAngle;
            const finalRotation = rotations + stopAngle + randomOffset;

            this.rotation = finalRotation;

            setTimeout(() => {
              this.spinning = false;
            }, 4000); // duration of the spin animation
          },
          getSegmentStyle(index) {
            const angle = (index / this.segments.length) * 360;
            return `transform: rotate(${angle}deg);`;
          },
        };
      }
    </script>
  </body>
</html>
